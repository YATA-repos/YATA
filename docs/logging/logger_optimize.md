# Loggerに追加実装が必要な機能一覧

以下の機能は `logger` パッケージ＋PrettyPrinter だけではまかなえないため、独自に実装または拡張する必要があります。

---

## 1. 初期化・ディレクトリ設定

| 機能                   | 内容                                                                                       | 備考                                   |
|-----------------------|--------------------------------------------------------------------------------------------|----------------------------------------|
| 環境変数／プラットフォーム別ログパス取得 | `.env` の `DEBUG_LOG_DIR`／`LOG_PATH_ANDROID/IOS/...` を参照し、未設定時に `getApplicationDocumentsDirectory()` を利用 | ログ出力先を柔軟に切り替え             |
| ログディレクトリの作成 | ログディレクトリが存在しない場合に再帰的に作成                                           | start-up 時に一度だけ                  |
| `initialize()` & `dispose()` | タイマー起動／停止やフラッシュ処理を含むライフサイクル管理                              | アプリ起動／終了時に呼び出し           |

---

## 2. バッファリング & フラッシュ制御

| 機能               | 内容                                                                                   | 備考                         |
|-------------------|----------------------------------------------------------------------------------------|-----------------------------|
| メッセージキュー      | `Queue<String>` に logEntry を一時保存                                                | サイズ上限：100件            |
| 定期フラッシュタイマー | 5秒ごとにバッファをファイルへ書き込み                                                 | `Timer.periodic`            |
| 即時フラッシュ       | `LogLevel.error` 時はバッファ溜めずに即座に flush                                       | 重要エラーの即時永続化確保    |

---

## 3. ファイル出力 & ローテーション

| 機能               | 内容                                                                                           | 備考                                |
|-------------------|------------------------------------------------------------------------------------------------|-------------------------------------|
| 書き込みリトライ      | I/O失敗時に100ms×(attempt+1)待機して最大3回リトライ                                            | 一時的なファイルロック回避          |
| 日付ベースのファイル名  | `YYYY-MM-DD-mixed.log` 形式で日別ログを生成                                                     | 日付が変わると自動的にファイル切替     |
| サイズ上限 & ローテーション | ファイルが10MB超えたら `…-mixed.1.log`, `…-mixed.2.log` … と順次リネーム                         | 無限増殖を防ぎつつ古いログを保持      |

---

## 4. 運用ユーティリティ

| 機能                  | 内容                                                                                                  | 備考                                |
|----------------------|-------------------------------------------------------------------------------------------------------|-------------------------------------|
| 動的ログレベル変更         | 実行中に最小表示レベルを `YataLogger.setMinimumLevel()` で切り替え                                        | `logger` の `level` パラメータへ反映 |
| ログ統計取得 (`getLogStats`) | 総ファイル数、総サイズ、バッファ長、現在の最小レベル、フラッシュ間隔などを返す                              | デバッグ時の可視化や外部監視に有効    |
| 古いログ削除 (`cleanupOldLogs`) | 指定日数（初期30日）を超えた `.log` をスキャンして削除                                               | 運用中のディスク肥大を防止            |
| メッセージプレースホルダ対応   | `LogMessage` 定義を使ったパラメータ置換（`infoWithMessage` 等）                                       | 定型文管理・多言語化対応などに応用可能 |

---

## 5. レベル＆フォーマットマッピング

- **LogLevel→logger.Level** の対応表を提供  
- `error` 時の `StackTrace` や例外情報を `logger` の `error` メソッドに渡せるようラッピング  
- PrettyPrinter ではなく独自フォーマットした場合の一貫性管理

---

以上を `logger` の **Custom LogOutput** や **Wrapper クラス** として実装すれば、既存の LogService で担っていた機能をほぼそのまま移行できます。  

—  

**次のステップ例**  
- Custom `FileLogOutput` のサンプル実装  
- `Queue`＋`Timer` を組み込んだ `LogOutput` 拡張ガイド  
- `LogLevel` マッピングコード例  

必要があれば、さらに詳細なコード例をご提示します！
