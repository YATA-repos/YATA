# 在庫管理 UI 改善（Mock 対応）Intent

この文書は、在庫管理ページ（Inventory Management）の現状 UI とモック（_images/mocks/inventory_management_page.png）を比較し、現行画面に対して施すべき改善の意図・狙いをまとめたものです。

- 対象画面: `lib/features/inventory/presentation/pages/inventory_management_page.dart`
- 参照モック: `../_images/mocks/inventory_management_page.png`
- 参照現在: 本ブランチの実装（添付スクショと UI の見た目は概ね一致）

## 背景

現状の UI はモックを高い精度で再現していますが、運用上の利便性・一括操作・可読性の観点でいくつかの改善余地があります。特に「一括適用」の導線や「更新者情報」「ユニットに応じたステップ量」の考慮など、業務に直結する使い勝手を強化したいです。

## 目的（Goals）

- モックの意図を満たしつつ、実務で頻出する操作（複数行の一括適用/クリア）を第一級の操作として提供する。
- 情報密度を保ちつつ、可読性とアクセシビリティ（キーボード操作/支援技術）を底上げする。
- 未来のサービス連携（Service/Repository 統合）を見据え、UI/State を過度に複雑化させない。

## 非目的（Non-Goals）

- 今回はバックエンド API の実装/接続は含めません（UI 側の導線/状態まで）。
- 在庫モデルや永続化のスキーマ変更は行いません（必要に応じて別イシュー化）。

## 現状とモックの比較から得た主な示唆

- ヘッダー統計・ステータスピル（十分/少/危険）の表示とフィルタ挙動はモック相当。ドリルダウン（一覧へ移動）も実装済み。
- 検索・カテゴリフィルタはモック相当（Segmented）。
- テーブル列構成（カテゴリ/品目/在庫量/閾値/状態/調整/更新日時/適用）はモック相当。
- 行内ステッパーと差分表示（±/→ after）の視覚表現はモック相当だが、以下の改善余地がある:
  - 一括適用の導線が UI として未配置（Controller に `applySelected` / `applyAllVisible` は存在）。
  - `updatedBy` が表示されず、更新主体の把握が困難（監査/現場オペの問い合わせ対応で必要）。
  - 量のステップがユニット非依存（現在 delta は int）。kg/L の細かな増減（0.1 等）の業務要件に応えづらい。
- アクセシビリティ（セル/ボタンの semantics、フォーカス順、ショートカット）は今後の伸びしろ。

## 提案の柱

1) 選択ツールバーの強化
- 既存の「+1/-1」「選択解除」「削除」に加え、以下を追加:
  - 一括適用（選択行）: `applySelected()` に接続。確認ダイアログ付き。
  - 一括適用（表示中すべて）: `applyAllVisible()` に接続。フィルタ条件を明示して確認。
  - 選択行の差分クリア: `clearAdjustmentsForSelected()` へ接続。

2) 更新情報の可視化
- 「更新日時」セルに `Tooltip` で `updatedBy` を表示、または小型の「i」アイコンでホバー表示。
- 列追加は横幅圧迫の懸念があるため、まずはツールチップ方式を採用。

3) ユニット対応ステップ（将来拡張）
- 影響が広くなるため段階導入:
  - Phase 1: ステッパーは現状維持（int delta）だが、ユニットに応じた推奨ステップを UI 文言/ヒントで提示。
  - Phase 2: 差分を `double` 化し、`UnitConfig` の `step/decimals` に合わせたステッパーへ更改（Breaking change）。

4) アクセシビリティ/操作性
- テーブル操作のショートカット（例: Space=チェック切替、A=全選択、Esc=選択解除）を段階導入。
- ボタン/チップに `Semantics` を付与し、読み上げラベルとロールを明確化。

## 期待される効果

- まとめて処理するオペが減り、1オペ時の負担が低減。
- 更新主体の可視化により、現場の問い合わせ対応が容易に。
- 将来の数値精度要件（kg/L の 0.1 単位など）に備えた移行計画を確保。

## リスクと緩和

- 一括適用の誤操作: 確認ダイアログと「対象件数/合計差分」の明示で緩和。
- `double` 化の影響範囲拡大: 段階導入とテスト整備で制御。まずは Phase 1 の非破壊変更から。

## 参考

- コントローラ実装: `lib/features/inventory/presentation/controllers/inventory_management_controller.dart`
- ユニット設定: `lib/shared/utils/unit_config.dart`

