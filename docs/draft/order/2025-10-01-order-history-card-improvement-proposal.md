# 注文履歴カードの高さ改善提案

## 概要

注文履歴画面における`_OrderHistoryCard`の高さを削減し、一覧性を向上させるための具体的な改善案を提示する。

現状分析については `2025-10-01-order-history-card-height-analysis.md` を参照。

## 基本方針

### 設計原則

1. **一覧性の優先**: 詳細情報は詳細ダイアログで確認できるため、カードでは必要最小限の情報に絞る
2. **情報の重要度に応じた表示**: 重要な情報（金額、ステータス、受付コード）を優先的に表示
3. **横方向スペースの活用**: 縦積みではなく、横並び配置で高さを抑える
4. **レスポンシブ対応**: デバイスサイズに応じて表示内容を調整

### 削減目標

- **現状の最小高さ**: 約148px
- **改善後の目標高さ**: 約100-120px（約20-30%削減）
- **最大高さの制限**: 備考がある場合でも150px以内に抑える

## 改善案

### 案A: コンパクトカードレイアウト（推奨）

#### 概要

カード内のパディング・マージンを縮小し、情報を2行に集約する。

#### レイアウト構造

```
┌─────────────────────────────────────────────┐
│ [受付コード] [ステータス]    ¥金額 [支払方法]│ ← 第1行
│ 👤顧客名 | 🕐日時 | 商品1, 商品2, 他○件      │ ← 第2行
└─────────────────────────────────────────────┘
```

#### 具体的な変更点

1. **パディング削減**
   - カード全体: `YataSpacingTokens.lg`(24px) → `YataSpacingTokens.md`(16px)
   - 行間: `YataSpacingTokens.md`(16px) → `YataSpacingTokens.sm`(12px)

2. **注文明細の省略表示**
   - 展開表示をやめ、1行でカンマ区切りで表示
   - 最大2-3件まで表示し、残りは「他○件」
   - 例: `ラーメン, 餃子, 他2件`

3. **顧客名・日時の統合**
   - 別々の行から1行に統合
   - 区切り文字（`|`）で視覚的に分離

4. **備考の削除**
   - カード上では表示せず、詳細ダイアログでのみ表示

#### 高さ試算

```
カードパディング上: 16px
├─ ヘッダー行: 24px
├─ スペース: 12px
├─ 詳細行: 20px
└─ カードパディング下: 16px
合計: 約88px → 目標達成
```

#### メリット

- 高さを大幅に削減（約40%削減）
- 情報が均一にまとまり、スキャンしやすい
- 実装が比較的シンプル

#### デメリット

- 注文内容の詳細が一目で分からない
- 備考が見えなくなる（クリックが必要）

---

### 案B: テーブル風レイアウト

#### 概要

カード形式をやめ、テーブル（または疑似テーブル）形式で表示する。

#### レイアウト構造

```
┌────────┬──────┬────────┬────────┬─────────┐
│受付コード│ステータス│顧客名  │金額    │日時     │
├────────┼──────┼────────┼────────┼─────────┤
│ A-001  │ ●完了│田中太郎│¥1,500 │10/01 12:30│
│ A-002  │ ●完了│鈴木花子│¥2,300 │10/01 12:35│
...
```

#### 具体的な変更点

1. **YataDataTableの活用**
   - 既存の`YataDataTable`コンポーネントを使用
   - `lib/shared/components/data_display/data_table.dart`を活用

2. **カラム構成**
   - 受付コード（固定幅）
   - ステータス（アイコン + ラベル、固定幅）
   - 顧客名（可変幅）
   - 金額（右寄せ、固定幅）
   - 日時（固定幅）

3. **行のクリック**
   - 各行をクリックで詳細ダイアログを表示

4. **レスポンシブ対応**
   - モバイルでは一部カラムを非表示（顧客名など）
   - または、モバイルではカード表示に切り替え

#### 高さ試算

```
テーブルヘッダー: 40px
├─ データ行1件: 40-48px（パディング含む）
合計: 1件あたり約40-48px
```

#### メリット

- 最も高さを削減できる（約70%削減）
- 一覧性が極めて高い
- 情報のスキャンが容易

#### デメリット

- 注文明細が全く表示されない
- モバイル対応が複雑
- 現在のデザインからの乖離が大きい

---

### 案C: 2段階表示（折りたたみ式）

#### 概要

デフォルトではコンパクトに表示し、クリック/タップで詳細を展開する。

#### レイアウト構造（折りたたみ時）

```
┌─────────────────────────────────────────────┐
│ [受付コード] [ステータス]  ¥金額 [⌄展開]   │
└─────────────────────────────────────────────┘
```

#### レイアウト構造（展開時）

```
┌─────────────────────────────────────────────┐
│ [受付コード] [ステータス]  ¥金額 [⌃閉じる] │
├─────────────────────────────────────────────┤
│ 👤顧客名 | 🕐日時 | [支払方法]              │
│ ・商品1 × 2  ¥1,000                         │
│ ・商品2 × 1  ¥500                           │
│ 備考: ～～～                                │
└─────────────────────────────────────────────┘
```

#### 具体的な変更点

1. **折りたたみ状態の管理**
   - ローカル状態で各カードの展開状態を管理
   - デフォルトは折りたたみ

2. **展開ボタン**
   - カード右側に展開/折りたたみボタンを配置
   - アイコンで状態を表示（⌄/⌃）

3. **アニメーション**
   - 展開/折りたたみ時にアニメーション

#### 高さ試算

```
折りたたみ時:
カードパディング上: 16px
├─ ヘッダー行のみ: 24px
└─ カードパディング下: 16px
合計: 約56px

展開時:
現状とほぼ同じ（約150-200px）
```

#### メリット

- 一覧性と詳細表示を両立
- ユーザーが必要に応じて情報を確認できる
- デフォルトの高さは最も小さい

#### デメリット

- 展開操作が必要（ワンステップ増える）
- 実装が複雑（状態管理、アニメーション）
- 詳細ダイアログとの役割分担が曖昧

---

## 推奨案とその理由

### 推奨: 案A（コンパクトカードレイアウト）

#### 選定理由

1. **バランスの良さ**
   - 一覧性の向上と情報量のバランスが取れている
   - 重要な情報は保持しつつ、高さを削減

2. **実装の容易さ**
   - 既存のカード構造を維持しつつ、レイアウトを調整するだけ
   - 大規模なリファクタリング不要

3. **一貫性**
   - 現在のデザインシステムから大きく逸脱しない
   - 他の画面（注文管理画面など）との整合性を保てる

4. **段階的改善が可能**
   - まず案Aを実装し、必要に応じて案B・案Cを検討できる

5. **ユーザー体験**
   - クリック操作なしで主要情報を確認できる
   - 詳細ダイアログへの導線も明確

#### 留意点

- 注文明細の省略表示が分かりにくくならないよう、視覚的デザインに配慮
- モバイルでの表示確認が必要

---

## 補助的な改善案

推奨案（案A）に加えて、以下の補助的な改善も検討する価値がある：

### 1. カード間の余白削減

```dart
// ListView.separated の separatorBuilder
const SizedBox(height: YataSpacingTokens.md)  // 16px
↓
const SizedBox(height: YataSpacingTokens.sm)  // 12px
```

### 2. ヘッダーのフォントサイズ調整

```dart
// 受付コードのスタイル
textTheme.titleMedium  // 16px, fontWeight: 600
↓
textTheme.bodyLarge    // 16px, fontWeight: 500（軽量化）
```

### 3. アイコンサイズの統一

```dart
// 顧客名・日時のアイコン
size: 16
↓
size: 14（統一的に小さく）
```

### 4. レスポンシブ対応

```dart
// ResponsiveHelper を使用してデバイスサイズに応じた調整
final double cardPadding = ResponsiveHelper.isMobile(context) 
    ? YataSpacingTokens.sm 
    : YataSpacingTokens.md;
```

### 5. ページネーションの最適化

現状は20件/ページだが、カードが小さくなることで1ページあたりの表示件数を増やせる可能性がある：

```dart
// OrderHistoryController
static const int _pageLimit = 20;
↓
static const int _pageLimit = 30;  // または40
```

---

## デザイントークンへの影響

### 新規トークンの追加検討

案Aを実装する際、以下の新規トークンの追加を検討：

```dart
// spacing_tokens.dart
/// リストアイテム用の小さいパディング。
static const EdgeInsets listItemPadding = 
    EdgeInsets.symmetric(horizontal: 16.0, vertical: 12.0);

/// リストアイテム間の小さい余白。
static const double listItemSpacing = 12.0;
```

### 既存トークンの活用

新規トークンを追加せず、既存トークンの組み合わせで対応することも可能：

- パディング: `EdgeInsets.all(YataSpacingTokens.md)` → `EdgeInsets.all(YataSpacingTokens.md)`
- 行間: `YataSpacingTokens.md` → `YataSpacingTokens.sm`

---

## モバイル対応の考慮事項

### レイアウトの調整

モバイル（画面幅 < 768px）では、以下の調整を検討：

1. **カード内の情報を更に省略**
   - 支払い方法を非表示
   - 顧客名を短縮表示（最大15文字など）

2. **フォントサイズの調整**
   - ヘッダーフォントを `bodyMedium` に変更

3. **横方向のスペース活用**
   - 金額を右寄せでフル活用

### 実装例

```dart
final bool isMobile = ResponsiveHelper.isMobile(context);

// パディング調整
padding: EdgeInsets.all(
  isMobile ? YataSpacingTokens.sm : YataSpacingTokens.md,
)

// フォントサイズ調整
style: isMobile 
    ? Theme.of(context).textTheme.bodyMedium 
    : Theme.of(context).textTheme.titleMedium
```

---

## 実装優先順位

1. **最優先**: 案Aの基本実装（パディング削減、注文明細の省略表示）
2. **高**: 補助的改善（カード間余白削減、アイコンサイズ統一）
3. **中**: モバイル対応の最適化
4. **低**: デザイントークンの追加/整理
5. **将来的検討**: 案B・案Cの実装（ユーザーフィードバックに応じて）

---

## 関連ドキュメント

- 現状分析: `docs/draft/2025-10-01-order-history-card-height-analysis.md`
- 実装計画: `docs/plan/2025-10-01-order-history-card-improvement-plan.md`（作成予定）

---

## 次のステップ

1. 本提案のレビューと承認
2. 実装計画ドキュメントの作成（`docs/plan/`）
3. 実装の実施
4. ユーザーフィードバックの収集
5. 必要に応じた追加改善
