# 注文履歴カードの高さ問題分析

## 概要

注文履歴画面（`OrderHistoryPage`）において、各注文を表示する`_OrderHistoryCard`ウィジェットの高さが過剰であり、一覧性に欠けるという問題が報告されている。

本ドキュメントでは、現状の実装を分析し、高さが大きくなっている原因を特定する。

## 問題の詳細

### 現状のカード構造

`_OrderHistoryCard`（`lib/features/order/presentation/pages/order_history_page.dart` 296-480行目）は以下の要素で構成されている：

1. **ヘッダー行**（319-356行目）
   - 受付コード + ステータスバッジ（左側）
   - 金額 + 支払い方法（右側）

2. **顧客名・注文日時行**（361-398行目）
   - アイコン + 顧客名（左側）
   - アイコン + 注文日時（右側）

3. **注文明細リスト**（402-435行目）
   - 最大3件まで表示（各行：数量 × メニュー名 ¥価格）
   - 3件を超える場合は「他○件」と表示（438-447行目）

4. **備考欄**（450-473行目）
   - 備考がある場合のみ表示

### 高さが大きくなる原因

#### 1. パディング・マージンの積み重ね

- **カード全体のパディング**: `YataSpacingTokens.lg` = 24px（310行目）
- **要素間のスペース**:
  - ヘッダーと顧客名行の間: `YataSpacingTokens.md` = 16px（358行目）
  - 顧客名行と注文明細の間: `YataSpacingTokens.md` = 16px（400行目）
  - 注文明細内の各行間: `YataSpacingTokens.xs` = 8px（407行目）
  - 備考との間: `YataSpacingTokens.md` = 16px（451行目）

合計：24×2（上下パディング） + 16×2（セクション間） + 16（備考前）= **96px + コンテンツ高さ**

#### 2. 注文明細の展開表示

現状では注文明細を最大3件まで展開表示しているため、注文内容によってカード高さが大きく変動する：

- 1件の場合: 約20px
- 3件の場合: 約60px + 行間マージン

#### 3. 各行の高さ

- タイトル行（titleMedium）: 約24-28px
- 本文行（bodyMedium/bodySmall）: 約20-24px
- アイコン付き行: 最低16-20px（アイコンサイズ）+ パディング

### 最小ケースでの高さ試算

最も簡潔な注文（備考なし、1件の明細）の場合：

```
カードパディング上: 24px
├─ ヘッダー行: 28px
├─ スペース: 16px
├─ 顧客名・日時行: 20px
├─ スペース: 16px
├─ 注文明細1件: 20px
└─ カードパディング下: 24px
合計: 約148px
```

### 最大ケースでの高さ試算

複雑な注文（備考あり、3件の明細）の場合：

```
カードパディング上: 24px
├─ ヘッダー行: 28px
├─ スペース: 16px
├─ 顧客名・日時行: 20px
├─ スペース: 16px
├─ 注文明細3件: 60px + 行間16px
├─ スペース: 16px
└─ 備考エリア: 40-60px（内容による）
└─ カードパディング下: 24px
合計: 約220-240px
```

## 主要な問題点のまとめ

1. **パディング・マージンが大きい**
   - カード内パディング（24px）が大きい
   - 要素間のスペース（16px）が多用されている

2. **注文明細の展開表示**
   - 最大3件まで展開しているため、カード高さが不均一
   - 複数商品の注文でカードが縦に伸びる

3. **情報の階層が明確すぎる**
   - 各セクションが独立して配置され、縦方向に積み重なる構造
   - 横方向のスペースが十分活用されていない

4. **フォントサイズ・行間**
   - YataTypographyTokensのデフォルト値が一覧性より可読性重視の設定
   - `height: 1.5`（bodyMedium/bodySmall）が行間を広げている

## 影響範囲

### 現在の実装での影響

- **一覧性の低下**: 1画面に表示できる注文数が少ない
- **スクロール量の増加**: 過去の注文を探す際のスクロール負担が大きい
- **視認性**: カード間の余白（`YataSpacingTokens.md` = 16px）と相まって、さらに一覧性が低下

### ユーザー体験への影響

- 注文履歴を素早く確認したいユーザーにとって、スクロール操作が増える
- 特定の注文を探す際の効率が低下
- デバイスサイズが小さい場合（モバイル）、問題がより顕著になる

## 関連ファイル

- `lib/features/order/presentation/pages/order_history_page.dart`（`_OrderHistoryCard`）
- `lib/shared/foundations/tokens/spacing_tokens.dart`（スペーシング定義）
- `lib/shared/foundations/tokens/typography_tokens.dart`（タイポグラフィ定義）
- `lib/shared/components/layout/section_card.dart`（カードコンポーネント）

## 次のステップ

改善案の検討（別ドキュメント `2025-10-01-order-history-card-improvement-proposal.md` に記載）
