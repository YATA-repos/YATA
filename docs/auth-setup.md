# Authentication Setup Guide

## Overview

The YATA application uses Supabase for authentication with Google OAuth integration. This guide covers the setup and configuration required to get authentication working in your environment.

## Prerequisites

- Flutter development environment
- Supabase project
- Google Cloud Console project for OAuth

## Environment Configuration

### 1. Create Environment File

Create a `.env` file in the project root with the following variables:

```env
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
REDIRECT_URL=io.supabase.flutterquickstart://login-callback/
```

### 2. Required Dependencies

Ensure these dependencies are in your `pubspec.yaml`:

```yaml
dependencies:
  flutter_dotenv: ^5.0.0
  supabase_flutter: ^2.0.0
```

## Application Setup

### 1. Initialize in main.dart

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // Initialize Supabase client
  await SupabaseClientService.initialize();
  
  runApp(MyApp());
}
```

### 2. Deep Link Configuration

Configure your app to handle OAuth callbacks:

#### Android Configuration

Add to `android/app/src/main/AndroidManifest.xml`:

```xml
<activity
    android:name=".MainActivity"
    android:exported="true"
    android:launchMode="singleTop"
    android:theme="@style/LaunchTheme">
    
    <!-- Deep link for OAuth callback -->
    <intent-filter android:autoVerify="true">
        <action android:name="android.intent.action.VIEW" />
        <category android:name="android.intent.category.DEFAULT" />
        <category android:name="android.intent.category.BROWSABLE" />
        <data android:scheme="io.supabase.flutterquickstart" />
    </intent-filter>
</activity>
```

#### iOS Configuration

Add to `ios/Runner/Info.plist`:

```xml
<key>CFBundleURLTypes</key>
<array>
    <dict>
        <key>CFBundleURLName</key>
        <string>io.supabase.flutterquickstart</string>
        <key>CFBundleURLSchemes</key>
        <array>
            <string>io.supabase.flutterquickstart</string>
        </array>
    </dict>
</array>
```

## Supabase Configuration

### 1. Authentication Settings

In your Supabase dashboard:

1. Go to Authentication > Settings
2. Add your redirect URL: `io.supabase.flutterquickstart://login-callback/`
3. Enable Google provider
4. Configure Google OAuth credentials

### 2. Google OAuth Setup

1. Create project in Google Cloud Console
2. Enable Google+ API
3. Create OAuth 2.0 credentials
4. Add authorized redirect URIs
5. Copy client ID and secret to Supabase

## Error Handling

The authentication service includes comprehensive error handling:

- Connection timeouts (30 seconds)
- Invalid credentials
- Network connectivity issues
- Session expiration

All errors are logged using `dart:developer` for debugging purposes.

## Security Considerations

- Store sensitive credentials in environment variables
- Use HTTPS for all redirect URLs in production
- Implement proper session management
- Regular security audits of authentication flow

## Troubleshooting

### Common Issues

1. **Environment variables not loading**
   - Ensure `.env` file is in project root
   - Check file encoding (UTF-8)
   - Verify variable names match exactly

2. **OAuth callback not working**
   - Check deep link configuration
   - Verify redirect URL matches exactly
   - Test on physical device (not simulator)

3. **Session expiration**
   - Sessions automatically refresh 5 minutes before expiration
   - Check network connectivity for refresh requests
   - Verify Supabase project settings

### Debug Logging

Enable debug logging to troubleshoot issues:

```dart
import 'dart:developer' as developer;

// Logs are automatically generated by SupabaseClientService
// Check console output for authentication flow details
```